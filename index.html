<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AR Experience</title>
  <!-- Latest A-Frame and AR.js versions -->
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ar.js@3.3.2/aframe/build/aframe-ar.js"></script>
</head>

<body style="margin: 0; overflow: hidden;">
  <!-- AR scene with video settings to fix zoom -->
  <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: true; videoSettings: { facingMode: 'environment', width: 1280, height: 720 }">
    
    <!-- Marker to detect the image -->
    <a-marker preset="custom" type="pattern" url="pattern-garrafa.patt">
      <!-- Load your 3D model -->
      <a-entity id="bottle" gltf-model="url(garrafa.glb)" scale="0.25 0.25 0.25" position="0 0 0" animation-mixer></a-entity>
    </a-marker>

    <!-- Camera setup -->
    <a-entity camera></a-entity>
    
  </a-scene>

  <script>
    // Ensure camera permission is requested and check if it was granted
    navigator.mediaDevices.getUserMedia({ video: true })
    .then(function(stream) {
      console.log("Camera access granted!");
    })
    .catch(function(err) {
      console.error("Camera access denied or not available: ", err);
      alert("Camera access is required for AR. Please enable camera access in your browser settings.");
    });

    // Debug to ensure the camera and AR.js are working correctly
    document.querySelector('a-scene').addEventListener('loaded', function() {
      console.log("AR.js scene loaded successfully.");
    });

    document.querySelector('#bottle').addEventListener('click', function() {
      var entity = document.querySelector('#bottle');
      console.log("Object clicked: Triggering animation.");
      entity.setAttribute('animation-mixer', '');  // Trigger animation in the glTF model
    });

    // Check for AR.js source type and debugging info
    console.log("AR.js initialized with source type: webcam");
  </script>
</body>
</html>
